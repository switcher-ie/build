#!/usr/bin/env bash

set -eo pipefail

################################################################################
# Validate Inputs
################################################################################

function usage {
    echo "usage: $0 [tag]"
    echo "  tag         tag of the image version (eg. latest)"
    exit 1
}

[ -z "$1" ] && { usage; }

################################################################################
# Set Inputs
################################################################################

TAG=$1

################################################################################
# Constants
################################################################################

DIR="$(dirname "${BASH_SOURCE[0]}")"

################################################################################
# Setup Environment
################################################################################

source ${DIR}/env

################################################################################
# Set Variables
################################################################################

IMAGE="$ENDPOINT/$APP:$TAG"

################################################################################
# Login to AWS
################################################################################

$(aws ecr get-login --no-include-email)

################################################################################
# Push to Repository
################################################################################

$debug docker push "$IMAGE.build"
