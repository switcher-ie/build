#!/usr/bin/env bash

set -eo pipefail

################################################################################
# Validate Inputs
################################################################################

function usage {
    echo "usage: $0 [namespace]"
    echo "  namespace    namespace to promote the image (eg. production)"
    exit 1
}

[ -z "$1" ] && { usage; }

################################################################################
# Set Inputs
################################################################################

NAMESPACE=$1

################################################################################
# Constants
################################################################################

DIR="$(dirname "${BASH_SOURCE[0]}")"
ROOT="${DIR}/../../"

################################################################################
# Setup Environment
################################################################################

source ${DIR}/env

################################################################################
# Wait for each rollout
################################################################################

for config in ${ROOT}/k8s/base/deployments/*.yaml; do
  deployment=$(yq r $config metadata.name)
  $debug kubectl rollout status deployment/$deployment -n $NAMESPACE
done
